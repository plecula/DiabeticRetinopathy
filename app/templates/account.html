<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moje konto</title>

  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style3.css') }}">
</head>
<body>

<header class="main-header">
  <img id="menuIcon" onclick="toggleMenu()" src="{{ url_for('static', filename='IMG/burger.svg') }}" alt="menu" class="icon">

  <div class="header-buttons">
    {% if current_user.is_authenticated %}
      <div class="user-greeting">
        <div class="avatar-circle-header">
          {{ (current_user.name or current_user.email)[0]|upper }}
        </div>
        <span class="greeting-text">
          Cześć, {{ current_user.name or current_user.email }}!
        </span>
        <a href="{{ url_for('logout') }}" class="btn btn-outline">Wyloguj</a>
      </div>
    {% else %}
      <img src="{{ url_for('static', filename='IMG/account.svg') }}" alt="Logo konta" class="logo-icon">
      <a href="{{ url_for('login') }}" class="btn">Zaloguj się</a>
      <a href="{{ url_for('register') }}" class="btn btn-outline">Zarejestruj się</a>
    {% endif %}
  </div>
</header>


<main class="account-section">

  <!-- KARTA UŻYTKOWNIKA -->
 <section class="account-card">
  <div class="account-header">
    <div>
      <h1>Cześć, {{ current_user.name or current_user.email }}!</h1>
      <p class="account-subtitle">
        Twoja historia analiz w tej aplikacji.
      </p>
    </div>
    <div class="account-user">
      <div class="avatar-circle">
        <span>{{ (current_user.name or current_user.email)[0]|upper }}</span>
      </div>
      <div class="account-user-info">
        <span class="user-name">
          {{ current_user.name or current_user.email }}
        </span>
        <span class="user-email">
          {{ current_user.email }}
        </span>
      </div>
    </div>
  </div>
</section>


  <!-- HISTORIA BADAŃ -->
  <section class="history-card">
    <div class="history-header">
      <h2>Historia analiz</h2>
      <p class="history-subtitle">
        Zestawienie wykonanych analiz wraz z datą i wynikiem.
      </p>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <a href="{{ url_for('upload') }}" class="btn-primary-small">
          Dodaj nowe badanie
        </a>
        {% if records and records|length > 0 %}
          <a href="{{ url_for('download_all_pdf') }}" class="btn-primary-small" style="background:#10b981; box-shadow:none;">
            Pobierz raport PDF
          </a>
        {% endif %}
      </div>
    </div>

    {% if records and records|length > 0 %}
      <div class="history-table-wrapper">
        <table class="history-table">
          <thead>
            <tr>
              <th>Data badania</th>
              <th>Wynik</th>
              <th>Ocena modelu</th>
            </tr>
          </thead>
          <tbody>
          {% for r in records %}
            <tr>
              <td>{{ r.date.strftime("%Y-%m-%d %H:%M") if r.date else "-" }}</td>
              <td>
                {% if r.result == 0 %}
                  <span class="result-badge result-ok">Brak cech retinopatii</span>
                {% else %}
                  <span class="result-badge result-risk">Podejrzenie retinopatii</span>
                {% endif %}
              </td>
              <td>
                {% if r.score is not none %}
                  {{ "%.2f"|format(r.score) }}
                {% else %}
                  –
                {% endif %}
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="history-empty">
        Brak zapisanych analiz. Po wykonaniu badania w zakładce
        <strong>„Dodaj zdjęcie”</strong> wyniki pojawią się tutaj.
      </p>
    {% endif %}
  </section>

</main>

<!-- MENU BURGER -->
<div class="menu-overlay" id="menu">
<div class="menu-content">
  <div class="menu-close" onclick="toggleMenu()">&times;</div>
  <a href="{{ url_for('index') }}">STRONA GŁÓWNA</a>
  <a href="{{ url_for('upload') }}">DODAJ ZDJĘCIE</a>
  <a href="{{ url_for('account') }}">MOJE KONTO</a>

  {% if current_user.is_authenticated %}
    <a href="{{ url_for('logout') }}">WYLOGUJ</a>
  {% else %}
    <a href="{{ url_for('login') }}">ZALOGUJ SIĘ</a>
  {% endif %}
</div>
</div>


<div class="blur-overlay" id="blurOverlay" onclick="toggleMenu()"></div>

<script>
  function toggleMenu() {
    const menu = document.getElementById('menu');
    const blurOverlay = document.getElementById('blurOverlay');
    const icon = document.getElementById('menuIcon');

    const isActive = menu.classList.contains('active');

    if (isActive) {
      menu.classList.remove('active');
      blurOverlay.classList.remove('active');
      icon.style.opacity = '1';
    } else {
      menu.classList.add('active');
      blurOverlay.classList.add('active');
      icon.style.opacity = '0.6';
    }
  }
</script>

<footer class="main-footer">
  <div class="footer-inner">
    <span>© 2025 Plec Urszula</span>
    <span> Aplikacja do analizy dna oka pod kątem występowania retynopatii cukrzycowej</span>
  </div>
</footer>

</body>
</html>
